<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD  Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.dealight.mapper.ReservationMapper">

	<select id="findAll"
		resultType="com.dealight.domain.ReservationVO">
		SELECT
		*
		FROM tbl_rsvd
		ORDER BY in_date asc
	</select>


	<select id="findById"
		resultType="com.dealight.domain.ReservationVO">
		SELECT
		*
		FROM tbl_rsvd
		where id = #{id}
		ORDER BY in_date asc
	</select>

	<select id="findByStoreIdAndUserId"
		resultType="com.dealight.domain.ReservationVO">
		SELECT
		*
		FROM tbl_rsvd
		where store_id = #{storeId} and user_id
		= #{userId}
		ORDER BY in_date asc
	</select>

	<select id="findByStoreId"
		resultType="com.dealight.domain.ReservationVO">
		SELECT
		*
		FROM tbl_rsvd
		where store_id = #{storeId}
		ORDER BY in_date asc
	</select>

	<select id="findByStoreIdAndCurStus"
		resultType="com.dealight.domain.ReservationVO">
		SELECT
		*
		FROM tbl_rsvd
		where store_id = #{storeId} and stus_cd
		= #{stusCd}
		ORDER BY in_date asc
	</select>



	<select id="findByStoreIdToday"
		resultType="com.dealight.domain.ReservationVO">
		SELECT
		*
		FROM tbl_rsvd
		where store_id = #{storeId} and
		TO_CHAR(in_date,'YYYYMMDD') = #{today}
		ORDER BY in_date asc
	</select>

	<select id="findByStoreIdAndDate"
		resultType="com.dealight.domain.ReservationVO">
		SELECT
		*
		FROM tbl_rsvd
		where store_id = #{storeId} and
		TO_CHAR(in_date,'YYYYMMDD') = #{date}
		ORDER BY in_date asc
	</select>

	<select id="findByUserId"
		resultType="com.dealight.domain.ReservationVO">
		SELECT
		*
		FROM tbl_rsvd
		where user_id = #{userId}
		ORDER BY in_date asc
	</select>

	<select id="findMenuCntByStoreIdAndDate" resultType="HashMap">
		select count(*), d.menu_nm
		from
		(
		select id
		from tbl_rsvd
		where TO_CHAR(in_date,'YYYYMMDD') = #{date} and
		store_id = #{storeId}
		) r, tbl_rsvd_dtls d
		where r.id = d.rsvd_id
		GROUP BY menu_nm
		ORDER BY COUNT(*) desc
	</select>

	<select id="findUserByStoreIdAndDateAndStus"
		resultType="com.dealight.domain.UserVO">
		select *
		from (
		select *
		from tbl_rsvd
		where store_id = #{storeId}
		and stus_cd = 'C'
		and TO_CHAR(in_date,'YYYYMMDD') = #{date}
		) r, tbl_user u
		WHERE r.user_id = u.user_id
		ORDER BY in_date asc
	</select>

	<insert id="insert">
		INSERT
		INTO tbl_rsvd(id, store_id, user_id, htdl_id,
		aprv_no, pnum, time, stus_cd, tot_amt, tot_qty,in_date)
		VALUES
		(seq_rsvd.nextval,#{storeId},#{userId},#{htdlId},#{aprvNo},#{pnum},#{time},#{stusCd},#{totAmt},#{totQty},sysdate)
	</insert>

	<insert id="insertSelectKey">
		<selectKey keyProperty="id" order="BEFORE" resultType="long">
			select seq_rsvd.nextval from dual
		</selectKey>
		INSERT
		INTO tbl_rsvd(id, store_id, user_id, htdl_id, aprv_no, pnum,
		time, stus_cd, tot_amt, tot_qty,in_date)
		VALUES
		(#{id},#{storeId},#{userId},#{htdlId},#{aprvNo},#{pnum},#{time},#{stusCd},#{totAmt},#{totQty},sysdate)
	</insert>

	<update id="update">
		UPDATE tbl_rsvd
		SET
		store_id = #{storeId},
		user_id =
		#{userId},
		htdl_id = #{htdlId},
		aprv_no = #{aprvNo},
		pnum = #{pnum},
		time
		= #{time},
		stus_cd = #{stusCd},
		tot_amt = #{totAmt},
		tot_qty = #{totQty}
		where id = #{id}
	</update>

	<delete id="delete">
		DELETE
		FROM tbl_rsvd
		WHERE id = #{id}
	</delete>


</mapper>